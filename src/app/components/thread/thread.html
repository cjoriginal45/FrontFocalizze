<!-- El bloque principal del componente de hilo. Usamos <article> por semántica. -->
<!-- The main block of the thread component. We use <article> for semantics. -->
<article class="thread">
  <!-- Mini Header del Hilo -->
  <header class="thread__header">
    <a routerLink="/profile/{{ thread.user.username }}" class="thread__user">
      <img
        src="assets/images/gamer.png"
        alt="Avatar de {{ thread.user.name }}"
        class="thread__avatar"
      />
      <div class="thread__user-info">
        <span class="thread__display-name">{{ thread.user.name }}</span>
        <span class="thread__username">@{{ thread.user.username }}</span>
      </div>
    </a>
    <span class="thread__date">{{ thread.publicationDate | date : 'd MMM' }}</span>
  </header>

  <!-- Cuerpo del Hilo (solo el primer post) -->
  <div class="thread__body" [class.thread__body--expanded]="isExpanded">
    <!-- Contenido del Hilo -->
    <div class="thread__content">
      <!-- Post 1 (siempre visible) -->
      <div class="thread__post">
        <h3 class="thread__post-title">1° post</h3>
        <p class="thread__post-text">{{ thread.posts[0] }}</p>
      </div>

      <!-- Posts Adicionales (solo visibles si está expandido) -->
      @if (isExpanded) {
      <!-- Iteramos sobre el resto de los posts (del segundo en adelante) -->
      @for (post of thread.posts.slice(1); track $index) {
      <div class="thread__post">
        <h3 class="thread__post-title">{{ $index + 2 }}° post</h3>
        <p class="thread__post-text">{{ post }}</p>
      </div>
      } }
    </div>
    <!-- Botón "Ampliar" / "Ocultar" -->
    <!-- Usamos @if para mostrar el botón solo si hay más de 1 post -->
    @if (thread.posts.length > 1) {
    <a (click)="toggleExpansion()" class="thread__expand-btn">
      @if (isExpanded) { Ocultar - } @else { Ampliar + }
    </a>
    }
  </div>

  <!-- Opcional: Mostrar la categoría si está expandido -->
  <!--@if (isExpanded && thread.category) {
                <div class="thread__category-badge">
                Categoría: <a routerLink="/category/{{ thread.category.slug }}">{{ thread.category.name }}</a>
                </div>
            } -->

  <!-- Footer con Acciones -->
  <footer class="thread__footer">
    <!-- Acción: Me Gusta -->
    <div
      class="thread__action thread__action--like"
      (click)="toggleLike()"
      [class.thread__action--liked]="thread.isLiked"
    >
      @if (thread.isLiked) {
      <mat-icon class="thread__icon">favorite</mat-icon>
      } @else {
      <mat-icon class="thread__icon">favorite_border</mat-icon>
      }
      <span class="thread__counter">{{ thread.stats.likes | number }}</span>
    </div>

    <!-- Acción: Comentarios -->
    <a
      routerLink="/thread/{{ thread.id }}#comments"
      class="thread__action"
      (click)="onCommentClick()"
    >
      <mat-icon class="thread__icon">chat_bubble_outline</mat-icon>
      <span class="thread__counter">{{ thread.stats.comments | number }}</span>
    </a>

    <!-- Acción: Visualizaciones -->
    <div class="thread__action thread__action--views">
      <mat-icon class="thread__icon">bar_chart</mat-icon>
      <span class="thread__counter">{{ thread.stats.views | number }}</span>
    </div>

    <!-- Acción: Guardar -->
    <div class="thread__action" (click)="toggleSave()">
      @if (thread.isSaved) {
      <mat-icon class="thread__icon">bookmark</mat-icon>
      <span class="thread__action-text">Guardado</span>
      } @else {
      <mat-icon class="thread__icon">bookmark_border</mat-icon>
      <span class="thread__action-text">Guardar</span>
      }
    </div>
  </footer>
</article>
