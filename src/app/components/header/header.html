
<!-- CAMBIO: La etiqueta ahora es <app-menu> -->
<app-menu [isMobile$]="isMobile$"></app-menu>

<mat-toolbar class="header">
  <div class="header__section header__section--left">
    <button
      mat-icon-button
      class="header__button"
      (click)="onMenuClick()"
      aria-label="Abrir menú de navegación"
    >
      <mat-icon>menu</mat-icon>
    </button>
    <a href="/" class="header__logo-container hide-on-mobile"
      ><img class="header__logo" src="/assets/images/focalizze-logo.webp" alt="Focalizze logo"
    /></a>
  </div>
  <div class="header__section header__section--center">
  
    <!-- Usamos un <form> para capturar el evento 'submit' (Enter) -->
    <form class="header__search-form" (submit)="onSearchSubmit($event)">
      <mat-form-field class="header__search hide-on-mobile" appearance="outline">
        <input 
          matInput 
          type="search" 
          placeholder="Buscar..."
          [formControl]="searchControl"
          [matAutocomplete]="userAutocomplete" />
        <button mat-icon-button matSuffix type="submit" aria-label="Realizar búsqueda">
          <mat-icon>search</mat-icon>
        </button>
      </mat-form-field>
    </form>
  
    <!-- Panel de Autocompletado (solo para usuarios) -->
    <mat-autocomplete #userAutocomplete="matAutocomplete" (optionSelected)="onUserSelected($event)" [displayWith]="displayUser">
      @for (user of userSearchResults$ | async; track user.username) {
        <mat-option [value]="user.username">
          <!-- Estructura de la opción -->
          <div class="user-option">
            <img [src]="user.avatarUrl" class="user-option__avatar" alt="Avatar">
            <div class="user-option__info">
              <span class="user-option__display-name">{{ user.displayName }}</span>
              <span class="user-option__username">@{{ user.username }}</span>
            </div>
          </div>
        </mat-option>
      }
    </mat-autocomplete>
  
    <a href="/" class="header__logo-container show-on-mobile">
      <!-- ... logo ... -->
    </a>
  </div>
  <div class="header__section header__section--right">
    <button mat-icon-button class="header__button hide-on-mobile" aria-label="Ver notificaciones">
      <mat-icon>notifications</mat-icon>
    </button>
    <button
      mat-icon-button
      class="header__button hide-on-mobile"
      aria-label="Ver perfil de usuario"
    >
      <mat-icon>account_circle</mat-icon>
    </button>
    <button mat-icon-button class="header__button show-on-mobile" aria-label="Ver configuración">
      <mat-icon>settings</mat-icon>
    </button>
  </div>
</mat-toolbar>
