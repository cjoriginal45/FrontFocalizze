<section class="password-recovery">
  <header class="password-recovery__header">
    <div class="header__logo">
      <img src="assets/images/focalizze-logo-short.webp" alt="Focalizze" />
    </div>
    <div class="header__title">Donde menos es más</div>
  </header>

  <!-- VISTA 1: Solicitar Email -->
  @if (view === 'request') {
    <div class="password-recovery__panel">
      <h1 class="password-recovery__title">Recuperación de contraseña</h1>
      <p class="password-recovery__subtitle">
        Introduce tu correo electrónico y te enviaremos un enlace para restaurar tu contraseña.
      </p>
      <input
        class="password-recovery__input"
        type="email"
        placeholder="Ingrese su Correo Electrónico"
        [(ngModel)]="email"
        (keyup.enter)="requestReset()"
        [disabled]="isLoading"
      />
      <button class="password-recovery__button" (click)="requestReset()" [disabled]="isLoading">
        {{ isLoading ? 'Enviando...' : 'Enviar' }}
      </button>
      <a routerLink="/login" class="password-recovery__link">
        ¿Ya recuerdas tu contraseña? <span>Haz click aquí</span> para acceder.
      </a>
    </div>
  }

  <!-- VISTA 2: Ingresar Nueva Contraseña -->
  @if (view === 'reset') {
    <div class="password-recovery__panel">
      <h1 class="password-recovery__title">Crea tu nueva contraseña</h1>
      <input
        class="password-recovery__input"
        type="password"
        placeholder="Ingrese su nueva contraseña"
        [(ngModel)]="newPassword"
        [disabled]="isLoading"
      />
      <input
        class="password-recovery__input"
        type="password"
        placeholder="Vuelva a ingresar su nueva contraseña"
        [(ngModel)]="confirmPassword"
        (keyup.enter)="resetPassword()"
        [disabled]="isLoading"
      />
      <button class="password-recovery__button btn-wide" (click)="resetPassword()" [disabled]="isLoading">
        {{ isLoading ? 'Restableciendo...' : 'Restablecer contraseña' }}
      </button>
      @if (errorMessage) { <p class="error-message">{{ errorMessage }}</p> }
    </div>
  }

  <!-- VISTAS DE ESTADO -->
  @if (view === 'email_sent') {
    <div class="password-recovery__panel feedback-panel">
      <h2>¡Revisa tu correo!</h2>
      <p>Te hemos enviado un enlace a <strong>{{ email }}</strong> para restaurar tu contraseña. Por favor, revisa tu bandeja de entrada y spam.</p>
    </div>
  }
  @if (view === 'invalid_token') {
    <div class="password-recovery__panel feedback-panel">
      <h2>Enlace inválido</h2>
      <p>El enlace de recuperación es inválido o ha expirado. Por favor, solicita uno nuevo.</p>
      <a routerLink="/password-recovery" class="password-recovery__button">Volver</a>
    </div>
  }
  @if (view === 'success') {
    <div class="password-recovery__panel feedback-panel">
      <h2>¡Éxito!</h2>
      <p>Tu contraseña ha sido actualizada correctamente. Serás redirigido al login en unos segundos.</p>
    </div>
  }

  <p class="password-recovery__copyright">Copyright 2025</p>
</section>